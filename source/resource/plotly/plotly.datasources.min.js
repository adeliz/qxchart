var _newPlot=Plotly.newPlot;var _plot=Plotly.plot;var _addTraces=Plotly.addTraces;var _restyle=Plotly.restyle;Plotly.formatters={};Plotly.plot=function(gd,data,layout,datasources,config){_newPlot(gd,data,layout,config);if(datasources){var gd=getGraphDiv(gd);gd.datasources=datasources;loadData(gd,data,datasources)}};Plotly.newPlot=function(gd,data,layout,datasources,config){Plotly.plot(gd,data,layout,datasources,config)};Plotly.addTraces=function(gd,traces,newIndices){_addTraces(gd,traces,newIndices);var gd=getGraphDiv(gd);if(gd.datasources){loadData(gd,traces,gd.datasources)}};Plotly.restyle=function(gd,update,indices){_restyle(gd,update,indices);var gd=getGraphDiv(gd);for(var key in update){if(key.indexOf("source")>-1){loadData(gd,gd.data,gd.datasources);break}}};Plotly.load=function(gd,url,callback){Plotly.d3.json(url,function(error,result){Plotly.plot(gd,result.data,result.layout,result.datasources,result.config);if(callback){callback(result)}})};Plotly.updateDataSources=function(gd,update){var gd=getGraphDiv(gd);gd.datasources=update;loadData(gd,gd.data,gd.datasources)};Plotly.formatters.KDB=function(data,parameters){var resp=JSON.parse(data);var data={x:[[]],y:[[]]};var values=resp.queries[0].results[0].values;for(var i=1;i<values.length;i++){data.x[0].push(new Date(values[i][0]));data.y[0].push(parseFloat(values[i][1]))}return data};Plotly.formatters.CSV=function(data,parameters){var lines=data.split("\n");var separator=",";if(parameters!=null){if(parameters.separator!=null){var separator=parameters.separator}}var data={};for(var key in parameters){if(key!="separator"){data[key]=[[]];var format=parameters[key+"format"];for(var i=1;i<lines.length;i++){var val=lines[i].split(separator);if(format=="date"){data[key][0].push(new Date(val[parameters[key]]))}else{data[key][0].push(val[parameters[key]])}}}}return data};function loadData(gd,traces,datasources,tIndices,dsIndices){for(var i=0;i<datasources.length;i++){(function(index){var processData=function(error,result){for(var k=0;k<traces.length;k++){if(traces[k].source!=null){if(traces[k].source.id==datasources[index].id){if(traces[k].source.formatter!=null){var data=Plotly.formatters[traces[k].source.formatter](result.responseText,traces[k].source.parameters);_restyle(gd,data,k)}else{var tmpFunc=new Function("response","param",traces[k].source.script);var data=tmpFunc(result.responseText,traces[k].source.parameters);_restyle(gd,data,k)}}}}};var u=datasources[index].url;if(u){for(key in datasources[index].parameters){u+=key+"="+datasources[index].parameters[key]+"&"}var updateTraces=function(u){Plotly.d3.xhr(u,processData)};updateTraces(u)}else{var result={};result.responseText=datasources[index].data;processData(null,result)}})(i)}}function refreshData(gd,traces,datasources,tIndices,dsIndices){var refresh=5;console.log(datasources);if(refresh){var id=setInterval(function(){loadData(gd,traces,datasources,tIndices,dsIndices)},refresh*1e3)}}function getGraphDiv(gd){var gdElement;if(typeof gd==="string"){gdElement=document.getElementById(gd);if(gdElement===null){throw new Error("No DOM element with id '"+gd+"' exists on the page.")}return gdElement}else if(gd===null||gd===undefined){throw new Error("DOM element provided is null or undefined")}return gd}